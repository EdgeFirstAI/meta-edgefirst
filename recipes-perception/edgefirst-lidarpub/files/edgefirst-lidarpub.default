# EdgeFirst LiDAR Publisher (/etc/default/lidarpub)
#
# Environment variables for the edgefirst-lidarpub systemd service.
# Uncomment and modify values as needed. Lines beginning with # are ignored.
# Only one SENSOR_TYPE section should be active at a time.

# ---------------------------------------------------------------------------
# Common settings (apply to all sensor types)
# ---------------------------------------------------------------------------

# Log level for the application. Refer to RUST_LOG / tracing documentation.
# Examples: "info", "debug", "warn", "edgefirst_lidarpub=debug,info"
RUST_LOG="info"

# Sensor type: "ouster" or "robosense"
SENSOR_TYPE="ouster"

# Target device hostname, IP address, or pcap file path.
#   Ouster:    Required. IP or hostname of the sensor (e.g. "192.168.1.100").
#   Robosense: Optional. When set, filters incoming UDP packets to only
#              accept from this source IP (e.g. "192.168.1.200").
#   Pcap:      If the value is a valid pcap file path, it is used for
#              offline replay instead of connecting to a live sensor.
#TARGET=

# LiDAR frame transformation from base_link (camera).
# TF_VEC:  Translation "X Y Z" in meters.
# TF_QUAT: Rotation quaternion "X Y Z W".
#
# Uncomment ONE pair matching your hardware configuration:
#
# --- Maivin + Robosense E1R ---
# E1R mounted 2cm below the camera (base_link), facing forward.
# No rotation needed: E1R native frame aligns with ROS conventions.
#TF_VEC="0 0 -0.02"
#TF_QUAT="0 0 0 1"
#
# --- Maivin + Ouster with Mounting Kit ---
# Ouster mounted 19cm below the camera (base_link) using the Maivin
# Ouster Mounting Kit. ~180-degree Z rotation required because the
# Ouster 0-degree point is at the rear connector.
#TF_VEC="0 0 -0.19"
#TF_QUAT="0 0 -0.9998157 0.0191974"

# Base frame name for TF publishing.
#BASE_FRAME_ID="base_link"

# LiDAR child frame name for TF publishing.
#FRAME_ID="lidar"

# Zenoh base topic for LiDAR data.
# Published topics: {LIDAR_TOPIC}/points, {LIDAR_TOPIC}/clusters, etc.
#LIDAR_TOPIC="rt/lidar"

# Enable Tracy profiler broadcast. Requires the binary to be built with
# the "tracy" or "profiling" feature. Connect with the Tracy GUI to
# visualize per-frame pipeline timing (ground_filter, clustering, etc.).
#TRACY="false"

# ---------------------------------------------------------------------------
# Clustering settings
# ---------------------------------------------------------------------------

# Clustering algorithm. Leave empty to disable clustering.
#   ""       - Disabled (default). Only raw point clouds are published.
#   "dbscan" - Point-level DBSCAN with spatial hash neighbor search.
#              Most accurate but slower (~70ms on E1R 25k points, aarch64).
#   "voxel"  - Voxel connected-component clustering via BFS over occupied
#              voxels. Faster (~13ms on E1R 25k points) but coarser: objects
#              within one voxel width are always merged.
#CLUSTERING=""

# Clustering distance threshold in millimeters.
# For DBSCAN: 3D Euclidean radius for neighbor queries (eps parameter).
# For voxel:  Voxel cell size; adjacent occupied voxels are 26-connected.
# Typical range: 150-300. Smaller = more clusters, larger = more merging.
#CLUSTERING_EPS="200"

# Minimum number of points to form a cluster.
# Voxels or neighborhoods with fewer points are classified as noise (ID=0).
#CLUSTERING_MINPTS="4"

# Bridge threshold: minimum neighbors for a point/voxel to propagate
# during cluster expansion. When set higher than CLUSTERING_MINPTS,
# thin structures (ropes, wires, railings) won't merge separate objects.
# Points/voxels with MINPTS <= neighbors < BRIDGE are labeled as part of
# a cluster but don't expand it further â€” they act as border points.
# Set to 0 (default) for standard behavior (same as CLUSTERING_MINPTS).
# Recommended starting value: 8-12 for indoor scenes with thin obstacles.
#CLUSTERING_BRIDGE="0"

# ---------------------------------------------------------------------------
# Ground plane filter settings
# ---------------------------------------------------------------------------

# Enable IMU-guided ground plane removal before clustering.
# Uses the sensor's IMU to determine the gravity vector, then applies
# region-wise PCA to detect the ground surface and remove floor points.
# This prevents nearby objects from being merged via shared floor points.
# Requires IMU data: Robosense E1R has a built-in IMU via DIFOP packets.
#GROUND_FILTER="false"

# Ground slab thickness in millimeters.
# Points within this distance above the detected ground plane (and anything
# below it) are classified as ground and removed before clustering.
# Increase if floor points are still visible; decrease if low objects
# (e.g. shoes, cables on the floor) are being incorrectly removed.
# Typical range: 100-400. Default 150 is conservative.
#GROUND_THICKNESS="150"

# Known sensor height above ground in millimeters.
# When set, skips automatic PCA ground detection and uses this fixed height.
# Useful when auto-detection is unreliable (e.g. sensor looking straight
# down, or very few ground points visible). Leave unset for auto-detection.
#SENSOR_HEIGHT=

# ---------------------------------------------------------------------------
# Ouster settings (ignored when SENSOR_TYPE="robosense")
# ---------------------------------------------------------------------------

# Azimuth field of view: start and stop angles in degrees.
# The 0-degree point is the rear connector of the Ouster LiDAR.
AZIMUTH="0 360"

# LiDAR column and refresh rate. Format: "COLxHZ".
# Valid values: 512x10 1024x10 2048x10 512x20 1024x20
LIDAR_MODE="1024x10"

# Timestamp mode for the Ouster sensor.
# "internal" uses the internal oscillator (time since boot).
# "ptp1588" synchronizes to a PTP-1588 master (e.g. ptp4l on Maivin).
TIMESTAMP_MODE="internal"

# ---------------------------------------------------------------------------
# Robosense E1R settings (ignored when SENSOR_TYPE="ouster")
# ---------------------------------------------------------------------------

# MSOP (Main data Stream Output Protocol) UDP port.
#MSOP_PORT="6699"

# DIFOP (Device Information Output Protocol) UDP port.
# Also carries IMU data used by the ground filter.
#DIFOP_PORT="7788"

# Include noisy points (PointAttribute == 2) in the point cloud.
# By default noisy points are filtered out.
#INCLUDE_NOISY="false"

# Discover Robosense sensors on the network and exit.
# Listens for DIFOP packets and prints device information (serial,
# firmware version, time sync status). Useful for initial setup.
#DISCOVER="false"
